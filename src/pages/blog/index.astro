---
import BaseLayout from "@/layouts/BaseLayout.astro";
import BlogCard from "@/components/BlogCard.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog", ({ data }) => {
    if (import.meta.env.ASTRO_SHOW_DRAFTS === "true") {
        return true;
    }
    return !data.draft;
});
const sortedPosts = allPosts.sort(
    (a, b) =>
        new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime(),
);

// Get all unique tags
const allTags = [...new Set(allPosts.flatMap((post) => post.data.tags))];
---

<BaseLayout
    title="Blog - Pablo Fornali"
    description="Artículos sobre desarrollo web, programación, rol y reflexiones personales."
>
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                Blog
            </h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                Pensamientos sobre desarrollo web, rol, narrativa y otros temas
                que me apasionan.
            </p>
        </div>

        <!-- Tags Filter -->
        <div class="mb-12">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
                Categorías:
            </h2>
            <div class="flex flex-wrap gap-3">
                <a
                    href="/blog"
                    class="px-4 py-2 bg-primary text-white rounded-full font-medium hover:bg-primary-dark transition-colors"
                >
                    Todos
                </a>
                {
                    allTags.map((tag) => (
                        <a
                            href={`/blog?tag=${tag}`}
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full font-medium hover:bg-gray-300 transition-colors"
                        >
                            {tag}
                        </a>
                    ))
                }
            </div>
        </div>

        <!-- Blog Posts Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {
                sortedPosts.map((post) => (
                    <BlogCard
                        title={post.data.title}
                        description={post.data.description}
                        pubDate={post.data.pubDate}
                        cover={post.data.cover}
                        coverAlt={post.data.coverAlt}
                        tags={post.data.tags}
                        slug={post.slug}
                    />
                ))
            }
        </div>

        {
            sortedPosts.length === 0 && (
                <div class="text-center py-12">
                    <p class="text-gray-600 text-lg">
                        No hay posts disponibles todavía.
                    </p>
                </div>
            )
        }
    </div>
</BaseLayout>
